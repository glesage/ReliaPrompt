import{f as g,a as v,c as zt,t as Ut}from"../chunks/DpXxpRXC.js";import{o as _e}from"../chunks/brwGxWwK.js";import{p as ge,s as N,b as Vt,u as me,c as i,e as r,f as yt,a as fe,g as t,i as O,d as s,r as e,t as M,n as xe}from"../chunks/OLrnjfeW.js";import{d as be,s as u}from"../chunks/D0M6toz8.js";import{s as Gt,i as x,a as he}from"../chunks/CkCyRFQt.js";import{g as ye,o as $e,s as we,j as $t,l as wt,k as Kt,r as Me,f as Re,p as Se,m as Qt,q as Te,c as Ct,t as Wt}from"../chunks/DDc5wW8a.js";import{S as G,s as Mt}from"../chunks/CFOinvAZ.js";import{M as ke,i as Ce,a as Ie,s as Xt}from"../chunks/SCM_VZYY.js";import{E as Pe}from"../chunks/Cc98fMUf.js";var Ne=g('<div id="progress-section" class="progress-section"><div class="progress-label">Overall Progress</div> <div class="progress-bar-container"><div class="progress-bar"> </div></div> <div class="muted" style="font-size: 14px"> </div></div>'),Oe=g('<span class="duration-badge" title="Average response time"> </span>'),Le=g('<div class="llm-result-row"><span class="llm-result-name"> </span> <!> <!> <button class="btn-view-details" title="View details"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div>'),Ae=g('<div id="results-section" class="card"><h2>Results <span id="overall-score-badge"><!></span> <!></h2> <div id="llm-results" class="llm-results"></div></div>'),De=g('<div class="muted">No previous test runs for this prompt</div>'),Ee=g("<!> <!>",1),ze=g('<div class="previous-run-item" role="button" tabindex="0"><div class="previous-run-info"><span class="previous-run-date"> </span> <span class="previous-run-tests"> </span></div> <div class="previous-run-status"><!> <span> </span></div></div>'),Be=g('<div id="test-section" class="content-grid"><section class="content-col"><div class="card"><div class="card-header"><h2> </h2></div> <div class="muted mb-20"><!></div> <div class="helper-note mb-20">Test cases are shared across all versions of this prompt.</div> <div class="mb-20"><label for="runs-per-test">Runs per test case</label> <div class="range-row"><input type="range" id="runs-per-test" min="1" max="10"/> <span class="range-value"> </span></div> <small>More runs = more reliable results, but takes longer</small></div> <div id="test-models-selection" class="model-selection-section mb-20"><label>Models to test <span class="muted"> </span></label> <!></div> <button id="run-btn"> </button> <!></div></section> <section class="content-col"><!> <div class="card"><h2>Previous Test Runs</h2> <div><!></div></div></section></div>'),Je=g('<button id="test-details-close-btn" type="button" class="secondary">Close</button>'),qe=g('<div style="background: var(--color-bg-elevated); padding: 12px 16px; border-radius: 8px; margin-bottom: 16px;"><strong style="display: block; margin-bottom: 8px;">‚è± Response Time Statistics</strong> <div style="display: flex; gap: 24px; flex-wrap: wrap;"><div><span style="color: var(--color-text-muted);">Min:</span> <strong> </strong></div> <div><span style="color: var(--color-text-muted);">Max:</span> <strong> </strong></div> <div><span style="color: var(--color-text-muted);">Average:</span> <strong> </strong></div></div></div>'),Fe=g("<div><span> </span> <span> </span></div>"),He=g('<div style="margin-top: 12px;"><div style="font-size: 12px; color: var(--color-text-muted); margin-bottom: 8px;"><strong>Run Results:</strong></div> <div style="display: flex; flex-wrap: wrap; gap: 6px;"></div></div>'),Ue=g('<span class="duration-badge" style="font-size: 11px; opacity: 0.8;"> </span>'),Ve=g('<div><div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap;"><span style="font-weight: 500;"></span> <!> <!></div> <div style="margin-top: 6px;"><div style="font-size: 12px; color: var(--color-text-muted); margin-bottom: 4px;">Actual Output:</div> <div class="json-preview" style="font-size: 13px; max-height: 150px; overflow-y: auto;"> </div></div></div>'),Ge=g('<div style="margin-top: 12px; border-top: 1px solid var(--color-border); padding-top: 12px;"><div style="margin-bottom: 8px; font-weight: 600; color: var(--color-text-muted);">Individual Runs:</div> <!></div>'),Ke=g('<div class="test-case-detail"><div class="header"><strong></strong> <!></div> <div style="margin-top: 10px; margin-bottom: 5px;"><strong>Input:</strong></div> <div class="json-preview"> </div> <div style="margin-top: 10px; margin-bottom: 5px;"><strong>Expected:</strong></div> <div class="json-preview"> </div> <!> <!></div>'),Qe=g('<div id="test-details-content"><!> <div style="margin-bottom: 16px; display: flex; justify-content: flex-end;"><button type="button"> </button></div> <!></div>'),We=g('<header class="content-header"><div class="content-header-main"><h1 class="content-title">Test Runs</h1> <p class="content-subtitle">Run your prompt against selected models and inspect results.</p></div></header> <div class="content-body"><!></div> <!>',1);function os(Yt,Zt){ge(Zt,!0);const R=()=>Gt(we,"$selectedPrompt",Bt),vt=()=>Gt(Xt,"$selectedModels",Bt),[Bt,jt]=he();let K=N(0),st=N(1),Q=N(!1),Rt=N(0),It=N(""),F=N(null),ct=N(Vt([])),Pt=N(Vt({})),W=null,Nt=N(!1),S=N(null),X=N(!1);me(()=>{R()?(te(R().id),Ot(R().id)):(i(K,0),i(ct,[],!0),i(F,null))});async function te(a){try{const n=await ye(a);i(K,n.length,!0)}catch{i(K,0)}}async function Ot(a){try{i(ct,await $e(a),!0)}catch{i(ct,[],!0)}}async function ee(){if(!(!R()||vt().length===0)){i(Q,!0),i(Rt,0),i(It,""),i(F,null),Qt("Starting test run...");try{const{jobId:a}=await Te({promptId:R().id,runsPerTest:t(st),selectedModels:vt()});se(a)}catch(a){Ct(a.message),i(Q,!1)}}}function se(a){W&&clearInterval(W),W=setInterval(async()=>{try{const n=await Wt(a);i(Rt,n.progress||0,!0),i(It,`${n.completedTests||0} / ${n.totalTests||0} tests completed`),n.status==="completed"?(clearInterval(W),i(Q,!1),n.results&&Jt(n.results),R()&&Ot(R().id)):n.status==="failed"&&(clearInterval(W),i(Q,!1),Ct(n.error||"Test run failed"),R()&&Ot(R().id))}catch{Ct("Error checking test status")}},1e3)}function Jt(a){i(F,a,!0),i(Pt,{},!0);for(const n of a.llmResults)t(Pt)[n.llmName]=n}async function qt(a){try{const n=await Wt(a);n.results?Jt(n.results):Qt("No results available for this test run")}catch{Ct("Error loading test run results")}}function re(a){const n=t(Pt)[a];n&&(i(S,n,!0),i(X,!1),i(Nt,!0))}function Ft(){i(Nt,!1),i(S,null)}function Y(a){return a<1e3?`${a}ms`:`${(a/1e3).toFixed(2)}s`}function ae(a){const n=new Date(a);return n.toLocaleDateString()+" "+n.toLocaleTimeString()}function Lt(a){return a>1?a:Math.round(a*100)}function St(a){return!a||a.length===0?null:Lt(Math.max(...a.map(n=>n.score)))}function oe(a){try{return JSON.stringify(JSON.parse(a),null,2)}catch{return a}}const ne=O(()=>t(K)>0&&vt().length>0&&!t(Q));_e(()=>(Ce(),()=>{W&&clearInterval(W)}));var Ht=We(),At=r(yt(Ht),2),ie=s(At);{var le=a=>{Pe(a,{icon:"üöÄ",title:"Select a prompt",description:"Pick a prompt on the left to run tests and compare LLM outputs."})},de=a=>{var n=Be(),ut=s(n),T=s(ut),L=s(T),Z=s(L),pt=s(Z);e(Z),e(L);var E=r(L,2),_t=s(E);{var gt=o=>{var c=Ut();M(()=>u(c,`${t(K)??""} test case${t(K)!==1?"s":""} will be run ${t(st)??""} time${t(st)!==1?"s":""} each across selected models`)),v(o,c)},Tt=o=>{var c=Ut("No test cases found. Add test cases first.");v(o,c)};x(_t,o=>{t(K)>0?o(gt):o(Tt,!1)})}e(E);var mt=r(E,4),rt=r(s(mt),2),H=s(rt);Me(H);var ft=r(H,2),Dt=s(ft,!0);e(ft),e(rt),xe(2),e(mt);var xt=r(mt,2),z=s(xt),m=r(s(z)),at=s(m);e(m),e(z);var B=r(z,2);Ie(B,{get selectedModels(){return vt()},onchange:o=>Xt.set(o)}),e(xt);var w=r(xt,2);w.__click=ee;var ot=s(w,!0);e(w);var j=r(w,2);{var U=o=>{var c=Ne(),h=r(s(c),2),l=s(h),d=s(l);e(l),e(h);var p=r(h,2),C=s(p,!0);e(p),e(c),M(()=>{Mt(l,`width: ${t(Rt)??""}%`),u(d,`${t(Rt)??""}%`),u(C,t(It))}),v(o,c)};x(j,o=>{t(Q)&&o(U)})}e(T),e(ut);var nt=r(ut,2),J=s(nt);{var it=o=>{var c=Ae(),h=s(c),l=r(s(h)),d=s(l);G(d,{get score(){return t(F).overallScore},tooltip:"Overall"}),e(l);var p=r(l,2);{var C=y=>{{let _=O(()=>St(t(F).llmResults)/100);G(y,{get score(){return t(_)},tooltip:"Best LLM",variant:"best"})}};x(p,y=>{St(t(F).llmResults)!==null&&y(C)})}e(h);var b=r(h,2);$t(b,21,()=>t(F).llmResults,wt,(y,_)=>{var $=Le(),A=s($),D=s(A,!0);e(A);var q=r(A,2);G(q,{get score(){return t(_).score}});var I=r(q,2);{var V=f=>{var P=Oe(),dt=s(P);e(P),M(kt=>u(dt,`‚è± ${kt??""}`),[()=>Y(t(_).durationStats.avgMs)]),v(f,P)};x(I,f=>{t(_).durationStats&&f(V)})}var et=r(I,2);et.__click=()=>re(t(_).llmName),e($),M(()=>u(D,t(_).llmName)),v(y,$)}),e(b),e(c),v(o,c)};x(J,o=>{t(F)&&o(it)})}var tt=r(J,2),lt=r(s(tt),2),bt=s(lt);{var ht=o=>{var c=De();v(o,c)},k=o=>{var c=zt(),h=yt(c);$t(h,17,()=>t(ct),wt,(l,d)=>{var p=ze();p.__click=()=>qt(t(d).id),p.__keydown=f=>f.key==="Enter"&&qt(t(d).id);var C=s(p),b=s(C),y=s(b,!0);e(b);var _=r(b,2),$=s(_);e(_),e(C);var A=r(C,2),D=s(A);{var q=f=>{const P=O(()=>typeof t(d).results=="string"?JSON.parse(t(d).results):t(d).results);var dt=Ee(),kt=yt(dt);G(kt,{get score(){return t(P).overallScore},tooltip:"Overall"});var ce=r(kt,2);{var ue=Et=>{{let pe=O(()=>St(t(P).llmResults)/100);G(Et,{get score(){return t(pe)},tooltip:"Best LLM",variant:"best"})}};x(ce,Et=>{St(t(P).llmResults)!==null&&Et(ue)})}v(f,dt)};x(D,f=>{t(d).status==="completed"&&t(d).results&&f(q)})}var I=r(D,2);let V;var et=s(I,!0);e(I),e(A),e(p),M((f,P)=>{u(y,f),u($,`${t(d).totalTests??""} tests`),V=Kt(I,1,"status-indicator",null,V,{success:t(d).status==="completed",failure:t(d).status==="failed",pending:t(d).status==="pending"||t(d).status==="running"}),u(et,P)},[()=>ae(t(d).createdAt),()=>t(d).status.charAt(0).toUpperCase()+t(d).status.slice(1)]),v(l,p)}),v(o,c)};x(bt,o=>{t(ct).length===0?o(ht):o(k,!1)})}e(lt),e(tt),e(nt),e(n),M(()=>{u(pt,`Run tests for "${R().name??""}"`),u(Dt,t(st)),u(at,`(${vt().length??""} selected)`),w.disabled=!t(ne),u(ot,t(Q)?"Running...":"Run Tests")}),Re(H,()=>t(st),o=>i(st,o)),v(a,n)};x(ie,a=>{R()?a(de,!1):a(le)})}e(At);var ve=r(At,2);{const a=T=>{var L=zt(),Z=yt(L);{var pt=E=>{G(E,{get score(){return t(S).score}})};x(Z,E=>{t(S)&&E(pt)})}v(T,L)},n=T=>{var L=Je();L.__click=Ft,v(T,L)};let ut=O(()=>{var T;return((T=t(S))==null?void 0:T.llmName)||"Test Details"});ke(ve,{id:"test-details-modal",get open(){return t(Nt)},get title(){return t(ut)},wide:!0,onclose:Ft,titleBadge:a,footer:n,children:(T,L)=>{var Z=zt(),pt=yt(Z);{var E=_t=>{var gt=Qe(),Tt=s(gt);{var mt=z=>{var m=qe(),at=r(s(m),2),B=s(at),w=r(s(B),2),ot=s(w,!0);e(w),e(B);var j=r(B,2),U=r(s(j),2),nt=s(U,!0);e(U),e(j);var J=r(j,2),it=r(s(J),2),tt=s(it,!0);e(it),e(J),e(at),e(m),M((lt,bt,ht)=>{u(ot,lt),u(nt,bt),u(tt,ht)},[()=>Y(t(S).durationStats.minMs),()=>Y(t(S).durationStats.maxMs),()=>Y(t(S).durationStats.avgMs)]),v(z,m)};x(Tt,z=>{t(S).durationStats&&z(mt)})}var rt=r(Tt,2),H=s(rt);let ft;H.__click=()=>i(X,!t(X));var Dt=s(H,!0);e(H),e(rt);var xt=r(rt,2);$t(xt,17,()=>t(S).testCaseResults,wt,(z,m,at)=>{var B=Ke(),w=s(B),ot=s(w);ot.textContent=`#${at+1}`;var j=r(ot,2);G(j,{get score(){return t(m).averageScore}}),e(w);var U=r(w,4),nt=s(U);e(U);var J=r(U,4),it=s(J,!0);e(J);var tt=r(J,2);{var lt=k=>{var o=He(),c=r(s(o),2);$t(c,21,()=>t(m).runs,wt,(h,l,d)=>{const p=O(()=>Lt(t(l).score||0)),C=O(()=>t(p)>=90?"rgba(34, 197, 94, 0.15)":t(p)>=80?"rgba(234, 179, 8, 0.15)":"rgba(239, 68, 68, 0.15)"),b=O(()=>t(p)>=90?"var(--color-success)":t(p)>=80?"var(--color-warning)":"var(--color-danger)"),y=O(()=>t(l).isCorrect?"‚úì":t(p)>=80?"‚óê":"‚úó");var _=Fe(),$=s(_),A=s($,!0);e($);var D=r($,2),q=s(D);e(D),e(_),M((I,V)=>{Mt(_,`display: flex; align-items: center; gap: 4px; padding: 4px 8px; border-radius: 4px; background: ${t(C)??""}; font-size: 12px;`),Se(_,"title",`Run #${d+1}: ${t(p)??""}%${I??""}`),Mt($,`color: ${t(b)??""}; font-weight: bold;`),u(A,t(y)),Mt(D,`color: ${t(b)??""};`),u(q,`${t(p)??""}%${V??""}`)},[()=>t(l).durationMs!==void 0?", "+Y(t(l).durationMs):"",()=>t(l).durationMs!==void 0?` ¬∑ ${Y(t(l).durationMs)}`:""]),v(h,_)}),e(c),e(o),v(k,o)};x(tt,k=>{!t(X)&&t(m).runs&&t(m).runs.length>0&&k(lt)})}var bt=r(tt,2);{var ht=k=>{var o=Ge(),c=r(s(o),2);$t(c,17,()=>t(m).runs,wt,(h,l,d)=>{const p=O(()=>Lt(t(l).score||0)),C=O(()=>t(p)>=90?"var(--color-success)":t(p)>=80?"var(--color-warning)":"var(--color-danger)");var b=Ve(),y=s(b),_=s(y);_.textContent=`Run #${d+1}`;var $=r(_,2);G($,{get score(){return t(l).score}});var A=r($,2);{var D=et=>{var f=Ue(),P=s(f);e(f),M(dt=>u(P,`‚è± ${dt??""}`),[()=>Y(t(l).durationMs)]),v(et,f)};x(A,et=>{t(l).durationMs!==void 0&&et(D)})}e(y);var q=r(y,2),I=r(s(q),2),V=s(I,!0);e(I),e(q),e(b),M(()=>{Mt(b,`background: var(--color-bg-elevated); padding: 10px 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid ${t(C)??""};`),u(V,t(l).actualOutput||(t(l).error?`Error: ${t(l).error}`:"N/A"))}),v(h,b)}),e(o),v(k,o)};x(bt,k=>{t(X)&&t(m).runs&&t(m).runs.length>0&&k(ht)})}e(B),M((k,o)=>{u(nt,`${k??""}${t(m).input.length>200?"...":""}`),u(it,o)},[()=>t(m).input.substring(0,200),()=>oe(t(m).expectedOutput)]),v(z,B)}),e(gt),M(()=>{ft=Kt(H,1,"btn-toggle-runs",null,ft,{active:t(X)}),u(Dt,t(X)?"Hide Individual Runs":"Show Individual Runs")}),v(_t,gt)};x(pt,_t=>{t(S)&&_t(E)})}v(T,Z)},$$slots:{titleBadge:!0,footer:!0,default:!0}})}v(Yt,Ht),fe(),jt()}be(["click","keydown"]);export{os as component};
