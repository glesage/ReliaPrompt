import{f as m,a as v,c as Ge,t as He}from"../chunks/DpXxpRXC.js";import{o as Dt}from"../chunks/brwGxWwK.js";import{p as Jt,s as d,b as ge,u as Ke,c as t,f as ce,d as r,a as Bt,e as s,g as e,t as I,r as a,h as Nt,n as Qe,i as We}from"../chunks/OLrnjfeW.js";import{d as Rt,s as p}from"../chunks/D0M6toz8.js";import{s as Xe,i as b,a as Ot}from"../chunks/CkCyRFQt.js";import{g as Vt,a as zt,s as Ft,b as Ut,c as K,d as qt,e as $e,f as Ee,r as Ye,h as Gt,i as Ht,j as Ze,k as Ae,l as je,m as Kt,n as Qt}from"../chunks/DDc5wW8a.js";import{S as Wt,s as Xt}from"../chunks/CFOinvAZ.js";import{M as Yt,s as Zt,i as jt,a as et}from"../chunks/SCM_VZYY.js";import{E as tt}from"../chunks/Cc98fMUf.js";var ea=m('<div class="muted">No improvement jobs for this prompt yet</div>'),ta=m('<div class="previous-run-item" role="button" tabindex="0"><div class="previous-run-info"><span class="previous-run-date"> </span> <span class="previous-run-tests"> </span></div> <div class="previous-run-status"><!> <span> </span></div></div>'),aa=m('<span class="iteration-display"> </span>'),ra=m('<div class="score-item"><div class="label">Original</div> <div id="original-score" class="value"> </div></div>'),sa=m('<div class="score-item"><div class="label">Best</div> <div id="best-score" class="value improved"> </div></div>'),oa=m('<div class="score-item"><div class="label">Improvement</div> <div class="value improved"> </div></div>'),na=m('<div class="score-display"><!> <!> <!></div>'),la=m("<div> </div>"),ia=m('<div class="improved-prompt-section"><h3>âœ¨ Improved Prompt</h3> <pre> </pre> <button class="mt-20">Save as New Version</button></div>'),va=m('<div class="card"><div class="progress-header"><h2>Progress</h2> <!> <span id="status-badge"> </span></div> <!> <div id="progress-section" class="progress-section"><div class="progress-label">Overall Progress</div> <div class="progress-bar-container"><div class="progress-bar"> </div></div></div> <div id="log-output" class="log-container" style="margin-top: 16px;"></div></div> <!>',1),da=m('<div id="improve-section" class="content-grid"><section class="content-col"><div class="card"><h2>Improvement Settings</h2> <div class="muted mb-20"><!></div> <div class="form-group"><label for="max-iterations">Max iterations</label> <div class="range-row"><input type="range" id="max-iterations" min="1" max="10"/> <span class="range-value"> </span></div> <small>Each iteration tests, analyzes, and improves the prompt</small></div> <div class="form-group"><label for="runs-per-llm">Runs per LLM per test</label> <div class="range-row"><input type="range" id="runs-per-llm" min="1" max="5"/> <span class="range-value"> </span></div> <small>More runs = more reliable scores, but takes longer</small></div> <div id="improvement-model-selection" class="model-selection-section form-group"><label>Improvement Model <span class="muted">(picks one to rewrite the prompt)</span></label> <!></div> <div id="benchmark-models-selection" class="model-selection-section form-group"><label>Benchmark Models <span class="muted"> </span></label> <!></div> <button id="start-btn"> </button></div> <div class="card"><h2>Previous Jobs</h2> <!></div></section> <section class="content-col"><!></section></div>'),ca=m('<button type="button" class="secondary">Reset to Default</button> <button type="button" class="secondary">Cancel</button> <button type="button"> </button>',1),ua=m('<div class="muted">Loading template...</div>'),pa=m('<div class="form-group"><label for="template-text">Template</label> <textarea id="template-text" class="tall" placeholder="Enter the improvement prompt template..." style="min-height: 300px;"></textarea> <small></small></div>'),ma=m('<header class="content-header"><div class="content-header-main"><h1 class="content-title">Auto-Improve</h1> <p class="content-subtitle">Let an LLM iteratively improve your prompt by testing and refining based on test case results.</p></div> <div class="content-actions"><button type="button" class="btn btn-secondary btn-sm">Edit Template</button></div></header> <div class="content-body"><!></div> <!>',1);function Sa(at,rt){Jt(rt,!0);const _=()=>Xe(Ft,"$selectedPrompt",De),st=()=>Xe(Zt,"$selectedModels",De),[De,ot]=Ot();let A=d(0),Q=d(3),ue=d(1),W=d(ge([])),D=d(ge([])),h=d(!1),O=d(0),V=d(0),z=d(ge([])),M=d(null),w=d(null),C=d(null),X=d(ge([])),J=null,Y=d(!1),Z=d(""),Je=d(""),j=d(!1),pe=d(!1);Ke(()=>{_()?(nt(_().id),be(_().id)):(t(A,0),t(X,[],!0),lt())}),Ke(()=>{t(D,st(),!0)});async function nt(o){try{const l=await Vt(o);t(A,l.length,!0)}catch{t(A,0)}}async function be(o){try{t(X,await zt(o),!0)}catch{t(X,[],!0)}}function lt(){t(h,!1),t(O,0),t(V,0),t(z,[],!0),t(M,null),t(w,null),t(C,null)}async function it(){if(_()){if(e(W).length===0){K("Please select an improvement model");return}if(e(D).length===0){K("Please select at least one benchmark model");return}t(h,!0),t(O,0),t(V,0),t(z,["Starting improvement process..."],!0),t(M,null),t(w,null),t(C,null);try{const{jobId:o}=await Gt({promptId:_().id,maxIterations:e(Q),runsPerLlm:e(ue),improvementModel:e(W)[0],benchmarkModels:e(D)});vt(o)}catch(o){K(o.message||"Failed to start improvement"),t(h,!1)}}}function vt(o){J&&clearInterval(J),J=setInterval(async()=>{try{const l=await Ht(o);t(O,l.currentIteration/l.maxIterations*100),t(V,l.currentIteration,!0),t(z,l.log||[],!0),l.originalScore!==void 0&&t(M,l.originalScore,!0),l.bestScore!==void 0&&t(w,l.bestScore,!0),l.bestPromptContent&&t(C,l.bestPromptContent,!0),l.status==="completed"?(clearInterval(J),t(h,!1),$e("Improvement process completed!"),_()&&be(_().id)):l.status==="failed"&&(clearInterval(J),t(h,!1),K(l.error||"Improvement process failed"),_()&&be(_().id))}catch{}},1e3)}async function Be(o){t(O,o.currentIteration/o.maxIterations*100),t(V,o.currentIteration,!0),t(z,o.log||[],!0),t(M,o.originalScore??null,!0),t(w,o.bestScore??null,!0),t(C,o.bestPromptContent??null,!0),Kt(`Loaded job from ${Ne(o.createdAt)}`)}async function dt(){if(!_()||!e(C))return;await Qt(_().id,_().name,e(C),_().expectedSchema)&&$e("Improved prompt saved as new version!")}async function ct(){t(Y,!0),t(j,!0);try{const o=await Ut();t(Z,o.template,!0),t(Je,o.defaultTemplate,!0)}catch{K("Error loading template")}finally{t(j,!1)}}async function ut(){t(pe,!0);try{await qt(e(Z)),$e("Template saved!"),t(Y,!1)}catch{K("Error saving template")}finally{t(pe,!1)}}function pt(){t(Z,e(Je),!0)}function Ne(o){const l=new Date(o);return l.toLocaleDateString()+" "+l.toLocaleTimeString()}function me(o){return o>1?o:Math.round(o*100)}const mt=We(()=>e(A)>0&&e(W).length>0&&e(D).length>0&&!e(h)),he=We(()=>()=>e(M)===null||e(w)===null?null:me(e(w))-me(e(M)));Dt(()=>(jt(),()=>{J&&clearInterval(J)}));var Re=ma(),xe=ce(Re),Oe=s(r(xe),2),_t=r(Oe);_t.__click=ct,a(Oe),a(xe);var ye=s(xe,2),ft=r(ye);{var gt=o=>{tt(o,{icon:"ðŸ§ ",title:"Select a prompt",description:"Pick a prompt to auto-improve using LLM-based iterative refinement."})},bt=o=>{var l=da(),B=r(l),S=r(B),L=s(r(S),2),T=r(L);{var ee=n=>{var g=He();I(()=>p(g,`${e(A)??""} test case${e(A)!==1?"s":""} will be used for benchmarking.`)),v(n,g)},$=n=>{var g=He("No test cases found. Add test cases first.");v(n,g)};b(T,n=>{e(A)>0?n(ee):n($,!1)})}a(L);var P=s(L,2),F=s(r(P),2),te=r(F);Ye(te);var _e=s(te,2),xt=r(_e,!0);a(_e),a(F),Qe(2),a(P);var Ie=s(P,2),Ve=s(r(Ie),2),we=r(Ve);Ye(we);var ze=s(we,2),yt=r(ze,!0);a(ze),a(Ve),Qe(2),a(Ie);var Se=s(Ie,2),It=s(r(Se),2);et(It,{get selectedModels(){return e(W)},onchange:n=>{t(W,n.length>0?[n[n.length-1]]:[],!0)},mode:"radio"}),a(Se);var Me=s(Se,2),Pe=r(Me),Fe=s(r(Pe)),wt=r(Fe);a(Fe),a(Pe);var St=s(Pe,2);et(St,{get selectedModels(){return e(D)},onchange:n=>t(D,n,!0)}),a(Me);var fe=s(Me,2);fe.__click=it;var Mt=r(fe,!0);a(fe),a(S);var Ue=s(S,2),Pt=s(r(Ue),2);{var kt=n=>{var g=ea();v(n,g)},Ct=n=>{var g=Ge(),ae=ce(g);Ze(ae,17,()=>e(X),je,(re,c)=>{var N=ta();N.__click=()=>Be(e(c)),N.__keydown=k=>k.key==="Enter"&&Be(e(c));var R=r(N),U=r(R),ke=r(U,!0);a(U);var se=s(U,2),Ce=r(se);a(se),a(R);var q=s(R,2),oe=r(q);{var ne=k=>{Wt(k,{get score(){return e(c).bestScore},tooltip:"Best score"})};b(oe,k=>{e(c).status==="completed"&&e(c).bestScore!==void 0&&k(ne)})}var le=s(oe,2);let ie;var Le=r(le,!0);a(le),a(q),a(N),I((k,u)=>{p(ke,k),p(Ce,`${e(c).currentIteration??""}/${e(c).maxIterations??""} iterations`),ie=Ae(le,1,"status-indicator",null,ie,{success:e(c).status==="completed",failure:e(c).status==="failed",pending:e(c).status==="pending"||e(c).status==="running"}),p(Le,u)},[()=>Ne(e(c).createdAt),()=>e(c).status.charAt(0).toUpperCase()+e(c).status.slice(1)]),v(re,N)}),v(n,g)};b(Pt,n=>{e(X).length===0?n(kt):n(Ct,!1)})}a(Ue),a(B);var qe=s(B,2),Lt=r(qe);{var Tt=n=>{var g=va(),ae=ce(g),re=r(ae),c=s(r(re),2);{var N=u=>{var i=aa(),f=r(i);a(i),I(()=>p(f,`Iteration ${e(V)??""} of ${e(Q)??""}`)),v(u,i)};b(c,u=>{e(V)>0&&u(N)})}var R=s(c,2);let U;var ke=r(R,!0);a(R),a(re);var se=s(re,2);{var Ce=u=>{var i=na(),f=r(i);{var G=x=>{var y=ra(),E=s(r(y),2),ve=r(E);a(E),a(y),I(de=>p(ve,`${de??""}%`),[()=>me(e(M))]),v(x,y)};b(f,x=>{e(M)!==null&&x(G)})}var H=s(f,2);{var Te=x=>{var y=sa(),E=s(r(y),2),ve=r(E);a(E),a(y),I(de=>p(ve,`${de??""}%`),[()=>me(e(w))]),v(x,y)};b(H,x=>{e(w)!==null&&x(Te)})}var Et=s(H,2);{var At=x=>{var y=oa(),E=s(r(y),2),ve=r(E);a(E),a(y),I(de=>p(ve,`+${de??""}%`),[()=>e(he)()]),v(x,y)};b(Et,x=>{e(he)()!==null&&e(he)()>0&&x(At)})}a(i),v(u,i)};b(se,u=>{(e(M)!==null||e(w)!==null)&&u(Ce)})}var q=s(se,2),oe=s(r(q),2),ne=r(oe),le=r(ne);a(ne),a(oe),a(q);var ie=s(q,2);Ze(ie,21,()=>e(z),je,(u,i)=>{var f=la();let G;var H=r(f,!0);a(f),I(Te=>{G=Ae(f,1,"log-line",null,G,Te),p(H,e(i))},[()=>({success:e(i).includes("âœ“")||e(i).toLowerCase().includes("success")||e(i).toLowerCase().includes("complete"),error:e(i).includes("âœ—")||e(i).toLowerCase().includes("error")||e(i).toLowerCase().includes("fail"),info:e(i).includes("â„¹")||e(i).includes("â†’")||e(i).toLowerCase().includes("starting")||e(i).toLowerCase().includes("iteration")})]),v(u,f)}),a(ie),a(ae);var Le=s(ae,2);{var k=u=>{var i=ia(),f=s(r(i),2),G=r(f,!0);a(f);var H=s(f,2);H.__click=dt,a(i),I(()=>p(G,e(C))),v(u,i)};b(Le,u=>{e(C)&&!e(h)&&u(k)})}I((u,i)=>{U=Ae(R,1,"status-indicator",null,U,{success:!e(h)&&e(w)!==null}),p(ke,e(h)?"Running":"Completed"),Xt(ne,`width: ${u??""}%`),p(le,`${i??""}%`)},[()=>Math.round(e(O)),()=>Math.round(e(O))]),v(n,g)},$t=n=>{tt(n,{icon:"âš¡",title:"Ready to improve",description:"Configure settings and start the improvement process to see progress and results here."})};b(Lt,n=>{e(h)||e(z).length>0?n(Tt):n($t,!1)})}a(qe),a(l),I(()=>{p(xt,e(Q)),p(yt,e(ue)),p(wt,`(${e(D).length??""} selected)`),fe.disabled=!e(mt),p(Mt,e(h)?"Improving...":"Start Improvement")}),Ee(te,()=>e(Q),n=>t(Q,n)),Ee(we,()=>e(ue),n=>t(ue,n)),v(o,l)};b(ft,o=>{_()?o(bt,!1):o(gt)})}a(ye);var ht=s(ye,2);Yt(ht,{get open(){return e(Y)},title:"Improvement Prompt Template",wide:!0,onclose:()=>t(Y,!1),footer:l=>{var B=ca(),S=ce(B);S.__click=pt;var L=s(S,2);L.__click=()=>t(Y,!1);var T=s(L,2);T.__click=ut;var ee=r(T,!0);a(T),I(()=>{S.disabled=e(j),T.disabled=e(j)||e(pe),p(ee,e(pe)?"Saving...":"Save Template")}),v(l,B)},children:(l,B)=>{var S=Ge(),L=ce(S);{var T=$=>{var P=ua();v($,P)},ee=$=>{var P=pa(),F=s(r(P),2);Nt(F);var te=s(F,2);te.textContent="Available variables: {{original_prompt}}, {{test_results}}, {{test_cases}}",a(P),Ee(F,()=>e(Z),_e=>t(Z,_e)),v($,P)};b(L,$=>{e(j)?$(T):$(ee,!1)})}v(l,S)},$$slots:{footer:!0,default:!0}}),v(at,Re),Bt(),ot()}Rt(["click","keydown"]);export{Sa as component};
