import{f as _,a as d,c as ze,t as Fe}from"../chunks/DpXxpRXC.js";import{o as $t}from"../chunks/brwGxWwK.js";import{p as Et,s as u,b as fe,u as Ue,c as t,f as ve,d as r,a as At,e as s,g as e,t as y,r as a,h as Dt,n as qe,i as Ge}from"../chunks/OLrnjfeW.js";import{d as Jt,s as m}from"../chunks/D0M6toz8.js";import{s as He,i as h,a as Bt}from"../chunks/CkCyRFQt.js";import{g as Nt,a as Ot,s as Rt,b as Vt,c as q,d as zt,e as Ce,f as Le,r as Ke,h as Ft,i as Ut,j as Qe,k as We,l as Xe,m as qt,n as Gt}from"../chunks/B7dw2RBZ.js";import{S as Ht,s as Kt}from"../chunks/C2xc0nCd.js";import{M as Qt,s as Wt,i as Xt,a as Ye}from"../chunks/D5JLBBfG.js";import{E as Ze}from"../chunks/DDiGIpsu.js";var Yt=_('<div class="muted">No improvement jobs for this prompt yet</div>'),Zt=_('<div class="previous-run-item" role="button" tabindex="0"><div class="previous-run-info"><span class="previous-run-date"> </span> <span class="previous-run-tests"> </span></div> <div class="previous-run-status"><!> <span> </span></div></div>'),jt=_('<span class="iteration-display"> </span>'),ea=_('<div class="score-item"><div class="label">Original</div> <div class="value"> </div></div>'),ta=_('<div class="score-item"><div class="label">Best</div> <div class="value improved"> </div></div>'),aa=_('<div class="score-item"><div class="label">Improvement</div> <div class="value improved"> </div></div>'),ra=_('<div class="score-display"><!> <!> <!></div>'),sa=_("<div> </div>"),oa=_('<div class="improved-prompt-section"><h3>âœ¨ Improved Prompt</h3> <pre> </pre> <button class="mt-20">Save as New Version</button></div>'),na=_('<div class="card"><div class="progress-header"><h2>Progress</h2> <!></div> <!> <div class="progress-section"><div class="progress-label">Overall Progress</div> <div class="progress-bar-container"><div class="progress-bar"> </div></div></div> <div class="log-container" style="margin-top: 16px;"></div></div> <!>',1),la=_('<div class="content-grid"><section class="content-col"><div class="card"><h2>Improvement Settings</h2> <div class="muted mb-20"><!></div> <div class="form-group"><label for="max-iterations">Max iterations</label> <div class="range-row"><input type="range" id="max-iterations" min="1" max="10"/> <span class="range-value"> </span></div> <small>Each iteration tests, analyzes, and improves the prompt</small></div> <div class="form-group"><label for="runs-per-llm">Runs per LLM per test</label> <div class="range-row"><input type="range" id="runs-per-llm" min="1" max="5"/> <span class="range-value"> </span></div> <small>More runs = more reliable scores, but takes longer</small></div> <div class="model-selection-section form-group"><label>Improvement Model <span class="muted">(picks one to rewrite the prompt)</span></label> <!></div> <div class="model-selection-section form-group"><label>Benchmark Models <span class="muted"> </span></label> <!></div> <button> </button></div> <div class="card"><h2>Previous Jobs</h2> <!></div></section> <section class="content-col"><!></section></div>'),ia=_('<button type="button" class="secondary">Reset to Default</button> <button type="button" class="secondary">Cancel</button> <button type="button"> </button>',1),va=_('<div class="muted">Loading template...</div>'),da=_('<div class="form-group"><label for="template-text">Template</label> <textarea id="template-text" class="tall" placeholder="Enter the improvement prompt template..." style="min-height: 300px;"></textarea> <small></small></div>'),ca=_('<header class="content-header"><div class="content-header-main"><h1 class="content-title">Auto-Improve</h1> <p class="content-subtitle">Let an LLM iteratively improve your prompt by testing and refining based on test case results.</p></div> <div class="content-actions"><button type="button" class="btn btn-secondary btn-sm">Edit Template</button></div></header> <div class="content-body"><!></div> <!>',1);function ya(je,et){Et(et,!0);const f=()=>He(Rt,"$selectedPrompt",Te),tt=()=>He(Wt,"$selectedModels",Te),[Te,at]=Bt();let A=u(0),G=u(3),de=u(1),H=u(fe([])),D=u(fe([])),w=u(!1),O=u(0),R=u(0),V=u(fe([])),S=u(null),M=u(null),k=u(null),K=u(fe([])),J=null,Q=u(!1),W=u(""),$e=u(""),X=u(!1),ce=u(!1);Ue(()=>{f()?(rt(f().id),ge(f().id)):(t(A,0),t(K,[],!0),st())}),Ue(()=>{t(D,tt(),!0)});async function rt(o){try{const i=await Nt(o);t(A,i.length,!0)}catch{t(A,0)}}async function ge(o){try{t(K,await Ot(o),!0)}catch{t(K,[],!0)}}function st(){t(w,!1),t(O,0),t(R,0),t(V,[],!0),t(S,null),t(M,null),t(k,null)}async function ot(){if(f()){if(e(H).length===0){q("Please select an improvement model");return}if(e(D).length===0){q("Please select at least one benchmark model");return}t(w,!0),t(O,0),t(R,0),t(V,["Starting improvement process..."],!0),t(S,null),t(M,null),t(k,null);try{const{jobId:o}=await Ft({promptId:f().id,maxIterations:e(G),runsPerLlm:e(de),improvementModel:e(H)[0],benchmarkModels:e(D)});nt(o)}catch(o){q(o.message||"Failed to start improvement"),t(w,!1)}}}function nt(o){J&&clearInterval(J),J=setInterval(async()=>{try{const i=await Ut(o);t(O,i.currentIteration/i.maxIterations*100),t(R,i.currentIteration,!0),t(V,i.log||[],!0),i.originalScore!==void 0&&t(S,i.originalScore,!0),i.bestScore!==void 0&&t(M,i.bestScore,!0),i.bestPromptContent&&t(k,i.bestPromptContent,!0),i.status==="completed"?(clearInterval(J),t(w,!1),Ce("Improvement process completed!"),f()&&ge(f().id)):i.status==="failed"&&(clearInterval(J),t(w,!1),q(i.error||"Improvement process failed"),f()&&ge(f().id))}catch{}},1e3)}async function Ee(o){t(O,o.currentIteration/o.maxIterations*100),t(R,o.currentIteration,!0),t(V,o.log||[],!0),t(S,o.originalScore??null,!0),t(M,o.bestScore??null,!0),t(k,o.bestPromptContent??null,!0),qt(`Loaded job from ${Ae(o.createdAt)}`)}async function lt(){if(!f()||!e(k))return;await Gt(f().id,f().name,e(k),f().expectedSchema)&&Ce("Improved prompt saved as new version!")}async function it(){t(Q,!0),t(X,!0);try{const o=await Vt();t(W,o.template,!0),t($e,o.defaultTemplate,!0)}catch{q("Error loading template")}finally{t(X,!1)}}async function vt(){t(ce,!0);try{await zt(e(W)),Ce("Template saved!"),t(Q,!1)}catch{q("Error saving template")}finally{t(ce,!1)}}function dt(){t(W,e($e),!0)}function Ae(o){const i=new Date(o);return i.toLocaleDateString()+" "+i.toLocaleTimeString()}function ue(o){return o>1?o:Math.round(o*100)}const ct=Ge(()=>e(A)>0&&e(H).length>0&&e(D).length>0&&!e(w)),he=Ge(()=>()=>e(S)===null||e(M)===null?null:ue(e(M))-ue(e(S)));$t(()=>(Xt(),()=>{J&&clearInterval(J)}));var De=ca(),be=ve(De),Je=s(r(be),2),ut=r(Je);ut.__click=it,a(Je),a(be);var xe=s(be,2),pt=r(xe);{var mt=o=>{Ze(o,{icon:"ðŸ§ ",title:"Select a prompt",description:"Pick a prompt to auto-improve using LLM-based iterative refinement."})},_t=o=>{var i=la(),B=r(i),I=r(B),C=s(r(I),2),L=r(C);{var Y=n=>{var g=Fe();y(()=>m(g,`${e(A)??""} test case${e(A)!==1?"s":""} will be used for benchmarking.`)),d(n,g)},T=n=>{var g=Fe("No test cases found. Add test cases first.");d(n,g)};h(L,n=>{e(A)>0?n(Y):n(T,!1)})}a(C);var P=s(C,2),z=s(r(P),2),Z=r(z);Ke(Z);var pe=s(Z,2),gt=r(pe,!0);a(pe),a(z),qe(2),a(P);var ye=s(P,2),Be=s(r(ye),2),Ie=r(Be);Ke(Ie);var Ne=s(Ie,2),ht=r(Ne,!0);a(Ne),a(Be),qe(2),a(ye);var we=s(ye,2),bt=s(r(we),2);Ye(bt,{get selectedModels(){return e(H)},onchange:n=>{t(H,n.length>0?[n[n.length-1]]:[],!0)},mode:"radio"}),a(we);var Se=s(we,2),Me=r(Se),Oe=s(r(Me)),xt=r(Oe);a(Oe),a(Me);var yt=s(Me,2);Ye(yt,{get selectedModels(){return e(D)},onchange:n=>t(D,n,!0)}),a(Se);var me=s(Se,2);me.__click=ot;var It=r(me,!0);a(me),a(I);var Re=s(I,2),wt=s(r(Re),2);{var St=n=>{var g=Yt();d(n,g)},Mt=n=>{var g=ze(),j=ve(g);Qe(j,17,()=>e(K),Xe,(ee,p)=>{var N=Zt();N.__click=()=>Ee(e(p)),N.__keydown=v=>v.key==="Enter"&&Ee(e(p));var F=r(N),te=r(F),ae=r(te,!0);a(te);var re=s(te,2),se=r(re);a(re),a(F);var _e=s(F,2),oe=r(_e);{var Pe=v=>{Ht(v,{get score(){return e(p).bestScore},tooltip:"Best score"})};h(oe,v=>{e(p).status==="completed"&&e(p).bestScore!==void 0&&v(Pe)})}var ne=s(oe,2);let c;var l=r(ne,!0);a(ne),a(_e),a(N),y((v,$)=>{m(ae,v),m(se,`${e(p).currentIteration??""}/${e(p).maxIterations??""} iterations`),c=We(ne,1,"status-indicator",null,c,{success:e(p).status==="completed",failure:e(p).status==="failed",pending:e(p).status==="pending"||e(p).status==="running"}),m(l,$)},[()=>Ae(e(p).createdAt),()=>e(p).status.charAt(0).toUpperCase()+e(p).status.slice(1)]),d(ee,N)}),d(n,g)};h(wt,n=>{e(K).length===0?n(St):n(Mt,!1)})}a(Re),a(B);var Ve=s(B,2),Pt=r(Ve);{var kt=n=>{var g=na(),j=ve(g),ee=r(j),p=s(r(ee),2);{var N=c=>{var l=jt(),v=r(l);a(l),y(()=>m(v,`Iteration ${e(R)??""} of ${e(G)??""}`)),d(c,l)};h(p,c=>{e(R)>0&&c(N)})}a(ee);var F=s(ee,2);{var te=c=>{var l=ra(),v=r(l);{var $=b=>{var x=ea(),E=s(r(x),2),le=r(E);a(E),a(x),y(ie=>m(le,`${ie??""}%`),[()=>ue(e(S))]),d(b,x)};h(v,b=>{e(S)!==null&&b($)})}var U=s(v,2);{var ke=b=>{var x=ta(),E=s(r(x),2),le=r(E);a(E),a(x),y(ie=>m(le,`${ie??""}%`),[()=>ue(e(M))]),d(b,x)};h(U,b=>{e(M)!==null&&b(ke)})}var Lt=s(U,2);{var Tt=b=>{var x=aa(),E=s(r(x),2),le=r(E);a(E),a(x),y(ie=>m(le,`+${ie??""}%`),[()=>e(he)()]),d(b,x)};h(Lt,b=>{e(he)()!==null&&e(he)()>0&&b(Tt)})}a(l),d(c,l)};h(F,c=>{(e(S)!==null||e(M)!==null)&&c(te)})}var ae=s(F,2),re=s(r(ae),2),se=r(re),_e=r(se);a(se),a(re),a(ae);var oe=s(ae,2);Qe(oe,21,()=>e(V),Xe,(c,l)=>{var v=sa();let $;var U=r(v,!0);a(v),y(ke=>{$=We(v,1,"log-line",null,$,ke),m(U,e(l))},[()=>({success:e(l).includes("âœ“")||e(l).toLowerCase().includes("success")||e(l).toLowerCase().includes("complete"),error:e(l).includes("âœ—")||e(l).toLowerCase().includes("error")||e(l).toLowerCase().includes("fail"),info:e(l).includes("â„¹")||e(l).includes("â†’")||e(l).toLowerCase().includes("starting")||e(l).toLowerCase().includes("iteration")})]),d(c,v)}),a(oe),a(j);var Pe=s(j,2);{var ne=c=>{var l=oa(),v=s(r(l),2),$=r(v,!0);a(v);var U=s(v,2);U.__click=lt,a(l),y(()=>m($,e(k))),d(c,l)};h(Pe,c=>{e(k)&&!e(w)&&c(ne)})}y((c,l)=>{Kt(se,`width: ${c??""}%`),m(_e,`${l??""}%`)},[()=>Math.round(e(O)),()=>Math.round(e(O))]),d(n,g)},Ct=n=>{Ze(n,{icon:"âš¡",title:"Ready to improve",description:"Configure settings and start the improvement process to see progress and results here."})};h(Pt,n=>{e(w)||e(V).length>0?n(kt):n(Ct,!1)})}a(Ve),a(i),y(()=>{m(gt,e(G)),m(ht,e(de)),m(xt,`(${e(D).length??""} selected)`),me.disabled=!e(ct),m(It,e(w)?"Improving...":"Start Improvement")}),Le(Z,()=>e(G),n=>t(G,n)),Le(Ie,()=>e(de),n=>t(de,n)),d(o,i)};h(pt,o=>{f()?o(_t,!1):o(mt)})}a(xe);var ft=s(xe,2);Qt(ft,{get open(){return e(Q)},title:"Improvement Prompt Template",wide:!0,onclose:()=>t(Q,!1),footer:i=>{var B=ia(),I=ve(B);I.__click=dt;var C=s(I,2);C.__click=()=>t(Q,!1);var L=s(C,2);L.__click=vt;var Y=r(L,!0);a(L),y(()=>{I.disabled=e(X),L.disabled=e(X)||e(ce),m(Y,e(ce)?"Saving...":"Save Template")}),d(i,B)},children:(i,B)=>{var I=ze(),C=ve(I);{var L=T=>{var P=va();d(T,P)},Y=T=>{var P=da(),z=s(r(P),2);Dt(z);var Z=s(z,2);Z.textContent="Available variables: {{original_prompt}}, {{test_results}}, {{test_cases}}",a(P),Le(z,()=>e(W),pe=>t(W,pe)),d(T,P)};h(C,T=>{e(X)?T(L):T(Y,!1)})}d(i,I)},$$slots:{footer:!0,default:!0}}),d(je,De),At(),at()}Jt(["click","keydown"]);export{ya as component};
