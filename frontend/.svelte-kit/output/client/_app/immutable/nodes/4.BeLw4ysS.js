import{f as g,a as v,c as Gt,t as Qt}from"../chunks/DJX18OcT.js";import{o as fe}from"../chunks/8J-ESnej.js";import{G as Wt,c as s,r as e,t as R,h as t,D as S,p as me,y as O,z as Xt,d as xe,A as i,s as r,B as St,a as be,C as he}from"../chunks/J2kTv08O.js";import{s as c,d as ye}from"../chunks/D1iiyE8s.js";import{p as we,s as Yt,i as x,a as $e}from"../chunks/kHTcSwTF.js";import{t as Me,s as Ht,f as ee,g as Re,l as Se,b as Te,k as Tt,m as kt,r as ke,d as Ce,n as Zt,o as Pe,a as At,p as jt}from"../chunks/h8IXuia-.js";import{M as Ie,i as Ne,a as Ae,s as te}from"../chunks/CImCAzC8.js";import{E as Oe}from"../chunks/0wIc7ilS.js";function Ct(B,E,b,J){var Q=B.__style;if(Wt||Q!==E){var et=Me(E);(!Wt||et!==B.getAttribute("style"))&&(et==null?B.removeAttribute("style"):B.style.cssText=et),B.__style=E}return J}var Le=g("<span> </span>");function tt(B,E){let b=we(E,"variant",3,"default");function J(W){return W>1?W:Math.round(W*100)}const Q=S(()=>J(E.score)),et=S(()=>t(Q)>=90?"":t(Q)>=80?"medium":"low");var y=Le();let F;var G=s(y);e(y),R(()=>{F=Ht(y,1,`score-badge ${t(et)??""}`,null,F,{best:b()==="best"}),ee(y,"data-tooltip",E.tooltip),c(G,`${t(Q)??""}%`)}),v(B,y)}var De=g('<div id="progress-section" class="progress-section"><div class="progress-label">Overall Progress</div> <div class="progress-bar-container"><div class="progress-bar"> </div></div> <div class="muted" style="font-size: 14px"> </div></div>'),ze=g('<span class="duration-badge" title="Average response time"> </span>'),Be=g('<div class="llm-result-row"><span class="llm-result-name"> </span> <!> <!> <button class="btn-view-details" title="View details"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div>'),Ee=g('<div id="results-section" class="card"><h2>Results <span id="overall-score-badge"><!></span> <!></h2> <div id="llm-results" class="llm-results"></div></div>'),Je=g('<div class="muted">No previous test runs for this prompt</div>'),Fe=g("<!> <!>",1),Ge=g('<div class="previous-run-item" role="button" tabindex="0"><div class="previous-run-info"><span class="previous-run-date"> </span> <span class="previous-run-tests"> </span></div> <div class="previous-run-status"><!> <span> </span></div></div>'),He=g('<div id="test-section" class="content-grid"><section class="content-col"><div class="card"><div class="card-header"><h2> </h2></div> <div class="muted mb-20"><!></div> <div class="helper-note mb-20">Test cases are shared across all versions of this prompt.</div> <div class="mb-20"><label for="runs-per-test">Runs per test case</label> <div class="range-row"><input type="range" id="runs-per-test" min="1" max="10"/> <span class="range-value"> </span></div> <small>More runs = more reliable results, but takes longer</small></div> <div id="test-models-selection" class="model-selection-section mb-20"><label>Models to test <span class="muted"> </span></label> <!></div> <button id="run-btn"> </button> <!></div></section> <section class="content-col"><!> <div class="card"><h2>Previous Test Runs</h2> <div><!></div></div></section></div>'),Ue=g('<button id="test-details-close-btn" type="button" class="secondary">Close</button>'),Ve=g('<div style="background: var(--color-bg-elevated); padding: 12px 16px; border-radius: 8px; margin-bottom: 16px;"><strong style="display: block; margin-bottom: 8px;">‚è± Response Time Statistics</strong> <div style="display: flex; gap: 24px; flex-wrap: wrap;"><div><span style="color: var(--color-text-muted);">Min:</span> <strong> </strong></div> <div><span style="color: var(--color-text-muted);">Max:</span> <strong> </strong></div> <div><span style="color: var(--color-text-muted);">Average:</span> <strong> </strong></div></div></div>'),qe=g("<div><span> </span> <span> </span></div>"),Ke=g('<div style="margin-top: 12px;"><div style="font-size: 12px; color: var(--color-text-muted); margin-bottom: 8px;"><strong>Run Results:</strong></div> <div style="display: flex; flex-wrap: wrap; gap: 6px;"></div></div>'),Qe=g('<span class="duration-badge" style="font-size: 11px; opacity: 0.8;"> </span>'),We=g('<div><div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap;"><span style="font-weight: 500;"></span> <!> <!></div> <div style="margin-top: 6px;"><div style="font-size: 12px; color: var(--color-text-muted); margin-bottom: 4px;">Actual Output:</div> <div class="json-preview" style="font-size: 13px; max-height: 150px; overflow-y: auto;"> </div></div></div>'),Xe=g('<div style="margin-top: 12px; border-top: 1px solid var(--color-border); padding-top: 12px;"><div style="margin-bottom: 8px; font-weight: 600; color: var(--color-text-muted);">Individual Runs:</div> <!></div>'),Ye=g('<div class="test-case-detail"><div class="header"><strong></strong> <!></div> <div style="margin-top: 10px; margin-bottom: 5px;"><strong>Input:</strong></div> <div class="json-preview"> </div> <div style="margin-top: 10px; margin-bottom: 5px;"><strong>Expected:</strong></div> <div class="json-preview"> </div> <!> <!></div>'),Ze=g('<div id="test-details-content"><!> <div style="margin-bottom: 16px; display: flex; justify-content: flex-end;"><button type="button"> </button></div> <!></div>'),je=g('<header class="content-header"><div class="content-header-main"><h1 class="content-title">Test Runs</h1> <p class="content-subtitle">Run your prompt against selected models and inspect results.</p></div></header> <div class="content-body"><!></div> <!>',1);function ls(B,E){me(E,!0);const b=()=>Yt(Te,"$selectedPrompt",Q),J=()=>Yt(te,"$selectedModels",Q),[Q,et]=$e();let y=O(0),F=O(1),G=O(!1),W=O(0),Ot=O(""),X=O(null),ft=O(Xt([])),Lt=O(Xt({})),st=null,Dt=O(!1),k=O(null),rt=O(!1);xe(()=>{b()?(se(b().id),zt(b().id)):(i(y,0),i(ft,[],!0),i(X,null))});async function se(a){try{const n=await Re(a);i(y,n.length,!0)}catch{i(y,0)}}async function zt(a){try{i(ft,await Se(a),!0)}catch{i(ft,[],!0)}}async function re(){if(!(!b()||J().length===0)){i(G,!0),i(W,0),i(Ot,""),i(X,null),Zt("Starting test run...");try{const{jobId:a}=await Pe({promptId:b().id,runsPerTest:t(F),selectedModels:J()});ae(a)}catch(a){At(a.message),i(G,!1)}}}function ae(a){st&&clearInterval(st),st=setInterval(async()=>{try{const n=await jt(a);i(W,n.progress||0,!0),i(Ot,`${n.completedTests||0} / ${n.totalTests||0} tests completed`),n.status==="completed"?(clearInterval(st),i(G,!1),n.results&&Ut(n.results),b()&&zt(b().id)):n.status==="failed"&&(clearInterval(st),i(G,!1),At(n.error||"Test run failed"),b()&&zt(b().id))}catch{At("Error checking test status")}},1e3)}function Ut(a){i(X,a,!0),i(Lt,{},!0);for(const n of a.llmResults)t(Lt)[n.llmName]=n}async function Vt(a){try{const n=await jt(a);n.results?Ut(n.results):Zt("No results available for this test run")}catch{At("Error loading test run results")}}function oe(a){const n=t(Lt)[a];n&&(i(k,n,!0),i(rt,!1),i(Dt,!0))}function qt(){i(Dt,!1),i(k,null)}function at(a){return a<1e3?`${a}ms`:`${(a/1e3).toFixed(2)}s`}function ne(a){const n=new Date(a);return n.toLocaleDateString()+" "+n.toLocaleTimeString()}function Bt(a){return a>1?a:Math.round(a*100)}function Pt(a){return!a||a.length===0?null:Bt(Math.max(...a.map(n=>n.score)))}function ie(a){try{return JSON.stringify(JSON.parse(a),null,2)}catch{return a}}const le=S(()=>t(y)>0&&J().length>0&&!t(G));fe(()=>(Ne(),()=>{st&&clearInterval(st)}));var Kt=je(),Et=r(St(Kt),2),ve=s(Et);{var de=a=>{Oe(a,{icon:"üöÄ",title:"Select a prompt",description:"Pick a prompt on the left to run tests and compare LLM outputs."})},ce=a=>{var n=He(),mt=s(n),C=s(mt),L=s(C),ot=s(L),xt=s(ot);e(ot),e(L);var H=r(L,2),bt=s(H);{var ht=o=>{var u=Qt();R(()=>c(u,`${t(y)??""} test case${t(y)!==1?"s":""} will be run ${t(F)??""} time${t(F)!==1?"s":""} each across selected models`)),v(o,u)},It=o=>{var u=Qt("No test cases found. Add test cases first.");v(o,u)};x(bt,o=>{t(y)>0?o(ht):o(It,!1)})}e(H);var yt=r(H,4),vt=r(s(yt),2),Y=s(vt);ke(Y);var wt=r(Y,2),Jt=s(wt,!0);e(wt),e(vt),he(2),e(yt);var $t=r(yt,2),U=s($t),f=r(s(U)),dt=s(f);e(f),e(U);var V=r(U,2);Ae(V,{get selectedModels(){return J()},onchange:o=>te.set(o)}),e($t);var T=r($t,2);T.__click=re;var ct=s(T,!0);e(T);var nt=r(T,2);{var Z=o=>{var u=De(),w=r(s(u),2),l=s(w),d=s(l);e(l),e(w);var p=r(w,2),I=s(p,!0);e(p),e(u),R(()=>{Ct(l,`width: ${t(W)??""}%`),c(d,`${t(W)??""}%`),c(I,t(Ot))}),v(o,u)};x(nt,o=>{t(G)&&o(Z)})}e(C),e(mt);var ut=r(mt,2),q=s(ut);{var pt=o=>{var u=Ee(),w=s(u),l=r(s(w)),d=s(l);tt(d,{get score(){return t(X).overallScore},tooltip:"Overall"}),e(l);var p=r(l,2);{var I=$=>{{let _=S(()=>Pt(t(X).llmResults)/100);tt($,{get score(){return t(_)},tooltip:"Best LLM",variant:"best"})}};x(p,$=>{Pt(t(X).llmResults)!==null&&$(I)})}e(w);var h=r(w,2);Tt(h,21,()=>t(X).llmResults,kt,($,_)=>{var M=Be(),D=s(M),z=s(D,!0);e(D);var K=r(D,2);tt(K,{get score(){return t(_).score}});var N=r(K,2);{var j=m=>{var A=ze(),gt=s(A);e(A),R(Nt=>c(gt,`‚è± ${Nt??""}`),[()=>at(t(_).durationStats.avgMs)]),v(m,A)};x(N,m=>{t(_).durationStats&&m(j)})}var lt=r(N,2);lt.__click=()=>oe(t(_).llmName),e(M),R(()=>c(z,t(_).llmName)),v($,M)}),e(h),e(u),v(o,u)};x(q,o=>{t(X)&&o(pt)})}var it=r(q,2),_t=r(s(it),2),Mt=s(_t);{var Rt=o=>{var u=Je();v(o,u)},P=o=>{var u=Gt(),w=St(u);Tt(w,17,()=>t(ft),kt,(l,d)=>{var p=Ge();p.__click=()=>Vt(t(d).id),p.__keydown=m=>m.key==="Enter"&&Vt(t(d).id);var I=s(p),h=s(I),$=s(h,!0);e(h);var _=r(h,2),M=s(_);e(_),e(I);var D=r(I,2),z=s(D);{var K=m=>{const A=S(()=>typeof t(d).results=="string"?JSON.parse(t(d).results):t(d).results);var gt=Fe(),Nt=St(gt);tt(Nt,{get score(){return t(A).overallScore},tooltip:"Overall"});var pe=r(Nt,2);{var _e=Ft=>{{let ge=S(()=>Pt(t(A).llmResults)/100);tt(Ft,{get score(){return t(ge)},tooltip:"Best LLM",variant:"best"})}};x(pe,Ft=>{Pt(t(A).llmResults)!==null&&Ft(_e)})}v(m,gt)};x(z,m=>{t(d).status==="completed"&&t(d).results&&m(K)})}var N=r(z,2);let j;var lt=s(N,!0);e(N),e(D),e(p),R((m,A)=>{c($,m),c(M,`${t(d).totalTests??""} tests`),j=Ht(N,1,"status-indicator",null,j,{success:t(d).status==="completed",failure:t(d).status==="failed",pending:t(d).status==="pending"||t(d).status==="running"}),c(lt,A)},[()=>ne(t(d).createdAt),()=>t(d).status.charAt(0).toUpperCase()+t(d).status.slice(1)]),v(l,p)}),v(o,u)};x(Mt,o=>{t(ft).length===0?o(Rt):o(P,!1)})}e(_t),e(it),e(ut),e(n),R(()=>{c(xt,`Run tests for "${b().name??""}"`),c(Jt,t(F)),c(dt,`(${J().length??""} selected)`),T.disabled=!t(le),c(ct,t(G)?"Running...":"Run Tests")}),Ce(Y,()=>t(F),o=>i(F,o)),v(a,n)};x(ve,a=>{b()?a(ce,!1):a(de)})}e(Et);var ue=r(Et,2);{const a=C=>{var L=Gt(),ot=St(L);{var xt=H=>{tt(H,{get score(){return t(k).score}})};x(ot,H=>{t(k)&&H(xt)})}v(C,L)},n=C=>{var L=Ue();L.__click=qt,v(C,L)};let mt=S(()=>{var C;return((C=t(k))==null?void 0:C.llmName)||"Test Details"});Ie(ue,{id:"test-details-modal",get open(){return t(Dt)},get title(){return t(mt)},wide:!0,onclose:qt,titleBadge:a,footer:n,children:(C,L)=>{var ot=Gt(),xt=St(ot);{var H=bt=>{var ht=Ze(),It=s(ht);{var yt=U=>{var f=Ve(),dt=r(s(f),2),V=s(dt),T=r(s(V),2),ct=s(T,!0);e(T),e(V);var nt=r(V,2),Z=r(s(nt),2),ut=s(Z,!0);e(Z),e(nt);var q=r(nt,2),pt=r(s(q),2),it=s(pt,!0);e(pt),e(q),e(dt),e(f),R((_t,Mt,Rt)=>{c(ct,_t),c(ut,Mt),c(it,Rt)},[()=>at(t(k).durationStats.minMs),()=>at(t(k).durationStats.maxMs),()=>at(t(k).durationStats.avgMs)]),v(U,f)};x(It,U=>{t(k).durationStats&&U(yt)})}var vt=r(It,2),Y=s(vt);let wt;Y.__click=()=>i(rt,!t(rt));var Jt=s(Y,!0);e(Y),e(vt);var $t=r(vt,2);Tt($t,17,()=>t(k).testCaseResults,kt,(U,f,dt)=>{var V=Ye(),T=s(V),ct=s(T);ct.textContent=`#${dt+1}`;var nt=r(ct,2);tt(nt,{get score(){return t(f).averageScore}}),e(T);var Z=r(T,4),ut=s(Z);e(Z);var q=r(Z,4),pt=s(q,!0);e(q);var it=r(q,2);{var _t=P=>{var o=Ke(),u=r(s(o),2);Tt(u,21,()=>t(f).runs,kt,(w,l,d)=>{const p=S(()=>Bt(t(l).score||0)),I=S(()=>t(p)>=90?"rgba(34, 197, 94, 0.15)":t(p)>=80?"rgba(234, 179, 8, 0.15)":"rgba(239, 68, 68, 0.15)"),h=S(()=>t(p)>=90?"var(--color-success)":t(p)>=80?"var(--color-warning)":"var(--color-danger)"),$=S(()=>t(l).isCorrect?"‚úì":t(p)>=80?"‚óê":"‚úó");var _=qe(),M=s(_),D=s(M,!0);e(M);var z=r(M,2),K=s(z);e(z),e(_),R((N,j)=>{Ct(_,`display: flex; align-items: center; gap: 4px; padding: 4px 8px; border-radius: 4px; background: ${t(I)??""}; font-size: 12px;`),ee(_,"title",`Run #${d+1}: ${t(p)??""}%${N??""}`),Ct(M,`color: ${t(h)??""}; font-weight: bold;`),c(D,t($)),Ct(z,`color: ${t(h)??""};`),c(K,`${t(p)??""}%${j??""}`)},[()=>t(l).durationMs!==void 0?", "+at(t(l).durationMs):"",()=>t(l).durationMs!==void 0?` ¬∑ ${at(t(l).durationMs)}`:""]),v(w,_)}),e(u),e(o),v(P,o)};x(it,P=>{!t(rt)&&t(f).runs&&t(f).runs.length>0&&P(_t)})}var Mt=r(it,2);{var Rt=P=>{var o=Xe(),u=r(s(o),2);Tt(u,17,()=>t(f).runs,kt,(w,l,d)=>{const p=S(()=>Bt(t(l).score||0)),I=S(()=>t(p)>=90?"var(--color-success)":t(p)>=80?"var(--color-warning)":"var(--color-danger)");var h=We(),$=s(h),_=s($);_.textContent=`Run #${d+1}`;var M=r(_,2);tt(M,{get score(){return t(l).score}});var D=r(M,2);{var z=lt=>{var m=Qe(),A=s(m);e(m),R(gt=>c(A,`‚è± ${gt??""}`),[()=>at(t(l).durationMs)]),v(lt,m)};x(D,lt=>{t(l).durationMs!==void 0&&lt(z)})}e($);var K=r($,2),N=r(s(K),2),j=s(N,!0);e(N),e(K),e(h),R(()=>{Ct(h,`background: var(--color-bg-elevated); padding: 10px 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid ${t(I)??""};`),c(j,t(l).actualOutput||(t(l).error?`Error: ${t(l).error}`:"N/A"))}),v(w,h)}),e(o),v(P,o)};x(Mt,P=>{t(rt)&&t(f).runs&&t(f).runs.length>0&&P(Rt)})}e(V),R((P,o)=>{c(ut,`${P??""}${t(f).input.length>200?"...":""}`),c(pt,o)},[()=>t(f).input.substring(0,200),()=>ie(t(f).expectedOutput)]),v(U,V)}),e(ht),R(()=>{wt=Ht(Y,1,"btn-toggle-runs",null,wt,{active:t(rt)}),c(Jt,t(rt)?"Hide Individual Runs":"Show Individual Runs")}),v(bt,ht)};x(xt,bt=>{t(k)&&bt(H)})}v(C,ot)},$$slots:{titleBadge:!0,footer:!0,default:!0}})}v(B,Kt),be(),et()}ye(["click","keydown"]);export{ls as component};
