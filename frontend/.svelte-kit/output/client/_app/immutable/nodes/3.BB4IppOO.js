import{f as A,a as x,c as Ce}from"../chunks/DJX18OcT.js";import{l as Ye,m as Se,n as Ze,o as et,q as tt,v as at,w as st,x as rt,p as it,y as g,z as nt,d as ot,A as r,B as se,c as a,s as o,t as re,a as ct,r as s,h as e,C as $e,D as lt,E as Ae}from"../chunks/J2kTv08O.js";import{d as dt,s as N,e as ut}from"../chunks/D1iiyE8s.js";import{s as vt,i as I,a as pt}from"../chunks/kHTcSwTF.js";import{g as ft,a as $,b as _t,e as mt,c as ie,i as bt,r as ht,d as Oe,f as yt,u as xt,h as gt,j as wt,k as Tt,s as Et}from"../chunks/h8IXuia-.js";import{E as fe}from"../chunks/0wIc7ilS.js";function Me(i,p,n=!1){if(i.multiple){if(p==null)return;if(!tt(p))return at();for(var h of i.options)h.selected=p.includes(ne(h));return}for(h of i.options){var J=ne(h);if(st(J,p)){h.selected=!0;return}}(!n||p!==void 0)&&(i.selectedIndex=-1)}function Ct(i){var p=new MutationObserver(()=>{Me(i,i.__value)});p.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),rt(()=>{p.disconnect()})}function St(i,p,n=p){var h=new WeakSet,J=!0;Ye(i,"change",u=>{var v=u?"[selected]":":checked",f;if(i.multiple)f=[].map.call(i.querySelectorAll(v),ne);else{var M=i.querySelector(v)??i.querySelector("option:not([disabled])");f=M&&ne(M)}n(f),Se!==null&&h.add(Se)}),Ze(()=>{var u=p();if(i===document.activeElement){var v=et??Se;if(h.has(v))return}if(Me(i,u,J),J&&u===void 0){var f=i.querySelector(":checked");f!==null&&(u=ne(f),n(u))}i.__value=u,J=!1}),Ct(i)}function ne(i){return"__value"in i?i.__value:i.value}var Ot=A('<div class="muted">Loadingâ€¦</div>'),kt=A('<button type="button"><div class="tc-list-item-top"><div class="tc-list-item-title"> </div> <span class="pill pill-muted"> </span></div> <div class="tc-list-item-preview"> </div></button>'),Nt=A('<button type="button" class="btn btn-danger btn-sm">Delete</button>'),Jt=A('<div class="inline-message error"> </div>'),Lt=A('<form id="testcase-editor" class="editor-card"><div class="editor-header"><div><div class="editor-title"> </div> <div class="editor-subtitle"> </div></div> <div class="editor-header-actions"><!></div></div> <div class="editor-body"><div class="form-group"><label for="tc-input">Input (user message)</label> <textarea id="tc-input" placeholder="What will you send to the LLM?"></textarea></div> <div class="form-group"><label for="tc-expected-output">Expected output (JSON)</label> <textarea id="tc-expected-output" class="tall"></textarea> <small>Must be valid JSON. We compare structure + values.</small></div> <div class="form-group"><label for="tc-expected-output-type">Expected output type</label> <select id="tc-expected-output-type"><option>String</option><option>Array</option><option>Object</option></select></div></div> <div class="editor-footer"><div class="editor-footer-left"><!></div> <div class="editor-footer-right"><button type="button" class="btn btn-secondary btn-sm">Cancel</button> <button id="testcase-save-btn" type="submit" class="btn btn-sm"> </button></div></div></form>'),qt=A('<div id="test-case-section" class="split-view"><section class="split-pane split-pane-list" aria-label="Test cases list"><div class="split-pane-header"><div class="split-pane-title">Test cases <span class="pill"> </span></div> <input type="search" placeholder="Filter test casesâ€¦" autocomplete="off"/></div> <div id="test-cases-list" class="tc-list"><!></div></section> <section class="split-pane split-pane-detail" aria-label="Test case editor"><!></section></div> <div class="helper-note">Test cases are shared across all versions of this prompt.</div>',1),jt=A('<header class="content-header"><div class="content-header-main"><h1 class="content-title">Test Cases</h1> <p class="content-subtitle">Define inputs and expected JSON outputs. Edit fast with the split view.</p></div> <div class="content-actions"><button class="btn btn-secondary btn-sm">Export</button> <button class="btn btn-secondary btn-sm">Import</button> <button id="add-test-case-btn" class="btn btn-sm">New test case</button></div></header> <div class="content-body"><!></div>',1);function Rt(i,p){it(p,!0);const n=()=>vt(_t,"$selectedPrompt",h),[h,J]=pt();let u=g(nt([])),v=g(null),f=g("none"),M=g(""),_e=g(!1),W=g(""),z=g(""),B=g("array"),y=g(""),oe=g(!1);const me=lt(()=>()=>{const t=e(M).trim().toLowerCase();return t?e(u).filter(c=>c.input.toLowerCase().includes(t)||c.expectedOutput.toLowerCase().includes(t)):e(u)});ot(()=>{n()?G(n().id):(r(u,[],!0),be())});async function G(t){r(_e,!0);try{r(u,await ft(t),!0)}catch{$("Error loading test cases"),r(u,[],!0)}finally{r(_e,!1)}}function ke(t,c){r(f,t,!0),r(y,""),c?(r(W,c.input,!0),r(z,c.expectedOutput,!0),r(B,c.expectedOutputType,!0)):(r(W,""),r(z,""),r(B,"array"))}function be(){r(f,"none"),r(v,null),r(y,"")}function Pe(){n()&&(r(v,null),ke("create"))}function ce(t){r(v,t.id,!0),ke("edit",t)}async function De(){if(!n())return;const t=e(W).trim(),c=e(z).trim();if(!t){r(y,"Input is required.");return}if(!c){r(y,"Expected output is required.");return}try{JSON.parse(c)}catch{r(y,"Expected output must be valid JSON.");return}r(oe,!0),r(y,"");try{const _={input:t,expected_output:c,expected_output_type:e(B)};if(e(f)==="edit"&&e(v)){const m=await xt(e(v),_);ie("Test case updated"),await G(n().id),ce(m)}else{const m=await gt(n().id,_);ie("Test case created"),await G(n().id),ce(m)}}catch(_){r(y,_.message||"Error saving test case.",!0)}finally{r(oe,!1)}}async function Re(){if(!(!e(v)||!n())&&confirm("Delete this test case? This cannot be undone."))try{await wt(e(v)),ie("Test case deleted"),be(),await G(n().id)}catch(t){r(y,t.message||"Error deleting test case.",!0)}}async function Ue(){if(n())try{const t=await mt(n().id),c=JSON.stringify(t,null,2),_=new Blob([c],{type:"application/json"}),m=URL.createObjectURL(_),b=document.createElement("a");b.href=m,b.download=`test-cases-${n().name.replace(/[^a-z0-9]/gi,"_")}.json`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(m),ie(`Exported ${t.length} test case${t.length!==1?"s":""}`)}catch{$("Error exporting test cases")}}async function Fe(){if(!n())return;const t=document.createElement("input");t.type="file",t.accept="application/json",t.onchange=async c=>{var b;const _=c.target,m=(b=_==null?void 0:_.files)==null?void 0:b[0];if(m)try{const P=await m.text();let w;try{w=JSON.parse(P)}catch{$("Invalid JSON file");return}if(!Array.isArray(w)){$("JSON must be an array of test cases");return}for(let L=0;L<w.length;L++){const D=w[L];if(!D.input||!D.expected_output||!D.expected_output_type){$(`Test case ${L+1} is missing required fields`);return}try{JSON.parse(D.expected_output)}catch{$(`Test case ${L+1} has invalid JSON in expected_output`);return}}const H=w.length,le=H===0?"This will delete all existing test cases. Continue?":`This will replace all existing test cases with ${H} new test case${H!==1?"s":""}. Continue?`;if(!confirm(le))return;const K=await bt(n().id,w);ie(`Successfully imported ${K.count} test case${K.count!==1?"s":""}`),await G(n().id)}catch{$("Error reading file")}},t.click()}var Ne=jt(),he=se(Ne),Je=o(a(he),2),ye=a(Je);ye.__click=Ue;var xe=o(ye,2);xe.__click=Fe;var Le=o(xe,2);Le.__click=Pe,s(Je),s(he);var qe=o(he,2),We=a(qe);{var ze=t=>{fe(t,{icon:"ðŸ—‚",title:"Select a prompt",description:"Pick a prompt on the left to view and edit its test cases. Test cases are shared across all versions."})},Be=t=>{var c=qt(),_=se(c),m=a(_),b=a(m),P=a(b),w=o(a(P)),H=a(w,!0);s(w),s(P);var le=o(P,2);ht(le),s(b);var K=o(b,2),L=a(K);{var D=d=>{var T=Ot();x(d,T)},Ge=d=>{var T=Ce(),Q=se(T);{var V=E=>{fe(E,{icon:"ðŸ§ª",title:"No test cases yet",description:"Create one to start testing this prompt.",compact:!0})},X=E=>{var Y=Ce(),ge=se(Y);{var de=C=>{fe(C,{icon:"ðŸ”Ž",title:"No matches",description:"Try a different filter.",compact:!0})},we=C=>{var R=Ce(),Z=se(R);Tt(Z,19,()=>e(me)(),U=>U.id,(U,S,ee)=>{var O=kt();let F;O.__click=()=>ce(e(S));var q=a(O),j=a(q),ue=a(j);s(j);var te=o(j,2),ae=a(te,!0);s(te),s(q);var ve=o(q,2),Te=a(ve,!0);s(ve),s(O),re(pe=>{F=Et(O,1,"tc-list-item",null,F,{active:e(S).id===e(v)}),N(ue,`#${e(ee)+1}`),N(ae,e(S).expectedOutputType),N(Te,pe)},[()=>e(S).input.replace(/\s+/g," ").slice(0,120)||"(empty input)"]),x(U,O)}),x(C,R)};I(ge,C=>{e(me)().length===0?C(de):C(we,!1)},!0)}x(E,Y)};I(Q,E=>{e(u).length===0?E(V):E(X,!1)},!0)}x(d,T)};I(L,d=>{e(_e)?d(D):d(Ge,!1)})}s(K),s(m);var je=o(m,2),He=a(je);{var Ke=d=>{fe(d,{icon:"âœï¸",title:"Pick a test case",description:"Select one on the left, or create a new one.",compact:!0})},Qe=d=>{var T=Lt(),Q=a(T),V=a(Q),X=a(V),E=a(X,!0);s(X);var Y=o(X,2),ge=a(Y);s(Y),s(V);var de=o(V,2),we=a(de);{var C=l=>{var k=Nt();k.__click=Re,x(l,k)};I(we,l=>{e(f)==="edit"&&l(C)})}s(de),s(Q);var R=o(Q,2),Z=a(R),U=o(a(Z),2);Ae(U),s(Z);var S=o(Z,2),ee=o(a(S),2);Ae(ee),yt(ee,"placeholder",'[{"type":"company","name":"Microsoft"}]'),$e(2),s(S);var O=o(S,2),F=o(a(O),2),q=a(F);q.value=q.__value="string";var j=o(q);j.value=j.__value="array";var ue=o(j);ue.value=ue.__value="object",s(F),s(O),s(R);var te=o(R,2),ae=a(te),ve=a(ae);{var Te=l=>{var k=Jt(),Xe=a(k,!0);s(k),re(()=>N(Xe,e(y))),x(l,k)};I(ve,l=>{e(y)&&l(Te)})}s(ae);var pe=o(ae,2),Ie=a(pe);Ie.__click=()=>{if(e(v)){const l=e(u).find(k=>k.id===e(v));l&&ce(l)}else be()};var Ee=o(Ie,2),Ve=a(Ee,!0);s(Ee),s(pe),s(te),s(T),re(()=>{N(E,e(f)==="edit"?"Edit test case":"New test case"),N(ge,`Prompt: ${n().name??""}`),Ee.disabled=e(oe),N(Ve,e(oe)?"Saving...":"Save")}),ut("submit",T,l=>{l.preventDefault(),De()}),Oe(U,()=>e(W),l=>r(W,l)),Oe(ee,()=>e(z),l=>r(z,l)),St(F,()=>e(B),l=>r(B,l)),x(d,T)};I(He,d=>{e(f)==="none"?d(Ke):d(Qe,!1)})}s(je),s(_),$e(2),re(d=>N(H,d),[()=>e(me)().length]),Oe(le,()=>e(M),d=>r(M,d)),x(t,c)};I(We,t=>{n()?t(Be,!1):t(ze)})}s(qe),re(()=>{ye.disabled=!n(),xe.disabled=!n(),Le.disabled=!n()}),x(i,Ne),ct(),J()}dt(["click"]);export{Rt as component};
