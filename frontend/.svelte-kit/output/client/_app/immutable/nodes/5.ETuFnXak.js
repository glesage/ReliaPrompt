import{f as _,a as d,c as Et,t as Ut}from"../chunks/DpXxpRXC.js";import{o as _e}from"../chunks/brwGxWwK.js";import{p as ge,s as P,b as Vt,u as fe,c as i,e as r,f as dt,a as me,g as t,i as N,d as s,r as e,t as R,n as xe}from"../chunks/OLrnjfeW.js";import{d as be,s as u}from"../chunks/D0M6toz8.js";import{s as Gt,i as h,a as he}from"../chunks/CkCyRFQt.js";import{g as ye,o as $e,s as we,j as yt,l as $t,k as Kt,r as Me,f as Re,p as Se,m as Qt,q as Te,c as kt,t as Wt}from"../chunks/B7dw2RBZ.js";import{S as K,s as wt}from"../chunks/C2xc0nCd.js";import{M as ke,i as Ce,a as Ie,s as Xt}from"../chunks/D5JLBBfG.js";import{E as Pe}from"../chunks/DDiGIpsu.js";var Ne=_('<div class="progress-section"><div class="progress-label">Overall Progress</div> <div class="progress-bar-container"><div class="progress-bar"> </div></div> <div class="muted" style="font-size: 14px"> </div></div>'),Oe=_('<span class="duration-badge" title="Average response time"> </span>'),Le=_('<div class="llm-result-row"><span class="llm-result-name"> </span> <!> <!> <button class="btn-view-details" title="View details"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button></div>'),Ae=_('<div class="card"><h2>Results <!> <!></h2> <div class="llm-results"></div></div>'),De=_('<div class="muted">No previous test runs for this prompt</div>'),Ee=_("<!> <!>",1),ze=_('<div class="previous-run-item" role="button" tabindex="0"><div class="previous-run-info"><span class="previous-run-date"> </span> <span class="previous-run-tests"> </span></div> <div class="previous-run-status"><!> <span> </span></div></div>'),Be=_('<div class="content-grid"><section class="content-col"><div class="card"><div class="card-header"><h2> </h2></div> <div class="muted mb-20"><!></div> <div class="helper-note mb-20">Test cases are shared across all versions of this prompt.</div> <div class="mb-20"><label for="runs-per-test">Runs per test case</label> <div class="range-row"><input type="range" id="runs-per-test" min="1" max="10"/> <span class="range-value"> </span></div> <small>More runs = more reliable results, but takes longer</small></div> <div class="model-selection-section mb-20"><label>Models to test <span class="muted"> </span></label> <!></div> <button> </button> <!></div></section> <section class="content-col"><!> <div class="card"><h2>Previous Test Runs</h2> <div><!></div></div></section></div>'),Je=_('<button type="button" class="secondary">Close</button>'),qe=_('<div style="background: var(--color-bg-elevated); padding: 12px 16px; border-radius: 8px; margin-bottom: 16px;"><strong style="display: block; margin-bottom: 8px;">‚è± Response Time Statistics</strong> <div style="display: flex; gap: 24px; flex-wrap: wrap;"><div><span style="color: var(--color-text-muted);">Min:</span> <strong> </strong></div> <div><span style="color: var(--color-text-muted);">Max:</span> <strong> </strong></div> <div><span style="color: var(--color-text-muted);">Average:</span> <strong> </strong></div></div></div>'),Fe=_("<div><span> </span> <span> </span></div>"),He=_('<div style="margin-top: 12px;"><div style="font-size: 12px; color: var(--color-text-muted); margin-bottom: 8px;"><strong>Run Results:</strong></div> <div style="display: flex; flex-wrap: wrap; gap: 6px;"></div></div>'),Ue=_('<span class="duration-badge" style="font-size: 11px; opacity: 0.8;"> </span>'),Ve=_('<div><div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap;"><span style="font-weight: 500;"></span> <!> <!></div> <div style="margin-top: 6px;"><div style="font-size: 12px; color: var(--color-text-muted); margin-bottom: 4px;">Actual Output:</div> <div class="json-preview" style="font-size: 13px; max-height: 150px; overflow-y: auto;"> </div></div></div>'),Ge=_('<div style="margin-top: 12px; border-top: 1px solid var(--color-border); padding-top: 12px;"><div style="margin-bottom: 8px; font-weight: 600; color: var(--color-text-muted);">Individual Runs:</div> <!></div>'),Ke=_('<div class="test-case-detail"><div class="header"><strong></strong> <!></div> <div style="margin-top: 10px; margin-bottom: 5px;"><strong>Input:</strong></div> <div class="json-preview"> </div> <div style="margin-top: 10px; margin-bottom: 5px;"><strong>Expected:</strong></div> <div class="json-preview"> </div> <!> <!></div>'),Qe=_('<!> <div style="margin-bottom: 16px; display: flex; justify-content: flex-end;"><button type="button"> </button></div> <!>',1),We=_('<header class="content-header"><div class="content-header-main"><h1 class="content-title">Test Runs</h1> <p class="content-subtitle">Run your prompt against selected models and inspect results.</p></div></header> <div class="content-body"><!></div> <!>',1);function os(Yt,Zt){ge(Zt,!0);const S=()=>Gt(we,"$selectedPrompt",zt),ct=()=>Gt(Xt,"$selectedModels",zt),[zt,jt]=he();let Q=P(0),st=P(1),W=P(!1),Mt=P(0),Ct=P(""),F=P(null),ut=P(Vt([])),It=P(Vt({})),X=null,Pt=P(!1),T=P(null),Y=P(!1);fe(()=>{S()?(te(S().id),Nt(S().id)):(i(Q,0),i(ut,[],!0),i(F,null))});async function te(a){try{const n=await ye(a);i(Q,n.length,!0)}catch{i(Q,0)}}async function Nt(a){try{i(ut,await $e(a),!0)}catch{i(ut,[],!0)}}async function ee(){if(!(!S()||ct().length===0)){i(W,!0),i(Mt,0),i(Ct,""),i(F,null),Qt("Starting test run...");try{const{jobId:a}=await Te({promptId:S().id,runsPerTest:t(st),selectedModels:ct()});se(a)}catch(a){kt(a.message),i(W,!1)}}}function se(a){X&&clearInterval(X),X=setInterval(async()=>{try{const n=await Wt(a);i(Mt,n.progress||0,!0),i(Ct,`${n.completedTests||0} / ${n.totalTests||0} tests completed`),n.status==="completed"?(clearInterval(X),i(W,!1),n.results&&Bt(n.results),S()&&Nt(S().id)):n.status==="failed"&&(clearInterval(X),i(W,!1),kt(n.error||"Test run failed"),S()&&Nt(S().id))}catch{kt("Error checking test status")}},1e3)}function Bt(a){i(F,a,!0),i(It,{},!0);for(const n of a.llmResults)t(It)[n.llmName]=n}async function Jt(a){try{const n=await Wt(a);n.results?Bt(n.results):Qt("No results available for this test run")}catch{kt("Error loading test run results")}}function re(a){const n=t(It)[a];n&&(i(T,n,!0),i(Y,!1),i(Pt,!0))}function qt(){i(Pt,!1),i(T,null)}function Z(a){return a<1e3?`${a}ms`:`${(a/1e3).toFixed(2)}s`}function ae(a){const n=new Date(a);return n.toLocaleDateString()+" "+n.toLocaleTimeString()}function Ot(a){return a>1?a:Math.round(a*100)}function Rt(a){return!a||a.length===0?null:Ot(Math.max(...a.map(n=>n.score)))}function oe(a){try{return JSON.stringify(JSON.parse(a),null,2)}catch{return a}}const ne=N(()=>t(Q)>0&&ct().length>0&&!t(W));_e(()=>(Ce(),()=>{X&&clearInterval(X)}));var Ft=We(),Lt=r(dt(Ft),2),ie=s(Lt);{var le=a=>{Pe(a,{icon:"üöÄ",title:"Select a prompt",description:"Pick a prompt on the left to run tests and compare LLM outputs."})},ve=a=>{var n=Be(),pt=s(n),k=s(pt),O=s(k),j=s(O),_t=s(j);e(j),e(O);var A=r(O,2),gt=s(A);{var St=o=>{var c=Ut();R(()=>u(c,`${t(Q)??""} test case${t(Q)!==1?"s":""} will be run ${t(st)??""} time${t(st)!==1?"s":""} each across selected models`)),d(o,c)},Tt=o=>{var c=Ut("No test cases found. Add test cases first.");d(o,c)};h(gt,o=>{t(Q)>0?o(St):o(Tt,!1)})}e(A);var ft=r(A,4),rt=r(s(ft),2),H=s(rt);Me(H);var mt=r(H,2),At=s(mt,!0);e(mt),e(rt),xe(2),e(ft);var xt=r(ft,2),D=s(xt),g=r(s(D)),at=s(g);e(g),e(D);var E=r(D,2);Ie(E,{get selectedModels(){return ct()},onchange:o=>Xt.set(o)}),e(xt);var w=r(xt,2);w.__click=ee;var ot=s(w,!0);e(w);var tt=r(w,2);{var U=o=>{var c=Ne(),y=r(s(c),2),l=s(y),v=s(l);e(l),e(y);var p=r(y,2),M=s(p,!0);e(p),e(c),R(()=>{wt(l,`width: ${t(Mt)??""}%`),u(v,`${t(Mt)??""}%`),u(M,t(Ct))}),d(o,c)};h(tt,o=>{t(W)&&o(U)})}e(k),e(pt);var nt=r(pt,2),z=s(nt);{var it=o=>{var c=Ae(),y=s(c),l=r(s(y));K(l,{get score(){return t(F).overallScore},tooltip:"Overall"});var v=r(l,2);{var p=f=>{{let m=N(()=>Rt(t(F).llmResults)/100);K(f,{get score(){return t(m)},tooltip:"Best LLM",variant:"best"})}};h(v,f=>{Rt(t(F).llmResults)!==null&&f(p)})}e(y);var M=r(y,2);yt(M,21,()=>t(F).llmResults,$t,(f,m)=>{var x=Le(),$=s(x),V=s($,!0);e($);var I=r($,2);K(I,{get score(){return t(m).score}});var B=r(I,2);{var L=J=>{var b=Oe(),q=s(b);e(b),R(vt=>u(q,`‚è± ${vt??""}`),[()=>Z(t(m).durationStats.avgMs)]),d(J,b)};h(B,J=>{t(m).durationStats&&J(L)})}var G=r(B,2);G.__click=()=>re(t(m).llmName),e(x),R(()=>u(V,t(m).llmName)),d(f,x)}),e(M),e(c),d(o,c)};h(z,o=>{t(F)&&o(it)})}var et=r(z,2),lt=r(s(et),2),bt=s(lt);{var ht=o=>{var c=De();d(o,c)},C=o=>{var c=Et(),y=dt(c);yt(y,17,()=>t(ut),$t,(l,v)=>{var p=ze();p.__click=()=>Jt(t(v).id),p.__keydown=b=>b.key==="Enter"&&Jt(t(v).id);var M=s(p),f=s(M),m=s(f,!0);e(f);var x=r(f,2),$=s(x);e(x),e(M);var V=r(M,2),I=s(V);{var B=b=>{const q=N(()=>typeof t(v).results=="string"?JSON.parse(t(v).results):t(v).results);var vt=Ee(),Ht=dt(vt);K(Ht,{get score(){return t(q).overallScore},tooltip:"Overall"});var ce=r(Ht,2);{var ue=Dt=>{{let pe=N(()=>Rt(t(q).llmResults)/100);K(Dt,{get score(){return t(pe)},tooltip:"Best LLM",variant:"best"})}};h(ce,Dt=>{Rt(t(q).llmResults)!==null&&Dt(ue)})}d(b,vt)};h(I,b=>{t(v).status==="completed"&&t(v).results&&b(B)})}var L=r(I,2);let G;var J=s(L,!0);e(L),e(V),e(p),R((b,q)=>{u(m,b),u($,`${t(v).totalTests??""} tests`),G=Kt(L,1,"status-indicator",null,G,{success:t(v).status==="completed",failure:t(v).status==="failed",pending:t(v).status==="pending"||t(v).status==="running"}),u(J,q)},[()=>ae(t(v).createdAt),()=>t(v).status.charAt(0).toUpperCase()+t(v).status.slice(1)]),d(l,p)}),d(o,c)};h(bt,o=>{t(ut).length===0?o(ht):o(C,!1)})}e(lt),e(et),e(nt),e(n),R(()=>{u(_t,`Run tests for "${S().name??""}"`),u(At,t(st)),u(at,`(${ct().length??""} selected)`),w.disabled=!t(ne),u(ot,t(W)?"Running...":"Run Tests")}),Re(H,()=>t(st),o=>i(st,o)),d(a,n)};h(ie,a=>{S()?a(ve,!1):a(le)})}e(Lt);var de=r(Lt,2);{const a=k=>{var O=Et(),j=dt(O);{var _t=A=>{K(A,{get score(){return t(T).score}})};h(j,A=>{t(T)&&A(_t)})}d(k,O)},n=k=>{var O=Je();O.__click=qt,d(k,O)};let pt=N(()=>{var k;return((k=t(T))==null?void 0:k.llmName)||"Test Details"});ke(de,{get open(){return t(Pt)},get title(){return t(pt)},wide:!0,onclose:qt,titleBadge:a,footer:n,children:(k,O)=>{var j=Et(),_t=dt(j);{var A=gt=>{var St=Qe(),Tt=dt(St);{var ft=D=>{var g=qe(),at=r(s(g),2),E=s(at),w=r(s(E),2),ot=s(w,!0);e(w),e(E);var tt=r(E,2),U=r(s(tt),2),nt=s(U,!0);e(U),e(tt);var z=r(tt,2),it=r(s(z),2),et=s(it,!0);e(it),e(z),e(at),e(g),R((lt,bt,ht)=>{u(ot,lt),u(nt,bt),u(et,ht)},[()=>Z(t(T).durationStats.minMs),()=>Z(t(T).durationStats.maxMs),()=>Z(t(T).durationStats.avgMs)]),d(D,g)};h(Tt,D=>{t(T).durationStats&&D(ft)})}var rt=r(Tt,2),H=s(rt);let mt;H.__click=()=>i(Y,!t(Y));var At=s(H,!0);e(H),e(rt);var xt=r(rt,2);yt(xt,17,()=>t(T).testCaseResults,$t,(D,g,at)=>{var E=Ke(),w=s(E),ot=s(w);ot.textContent=`#${at+1}`;var tt=r(ot,2);K(tt,{get score(){return t(g).averageScore}}),e(w);var U=r(w,4),nt=s(U);e(U);var z=r(U,4),it=s(z,!0);e(z);var et=r(z,2);{var lt=C=>{var o=He(),c=r(s(o),2);yt(c,21,()=>t(g).runs,$t,(y,l,v)=>{const p=N(()=>Ot(t(l).score||0)),M=N(()=>t(p)>=90?"rgba(34, 197, 94, 0.15)":t(p)>=80?"rgba(234, 179, 8, 0.15)":"rgba(239, 68, 68, 0.15)"),f=N(()=>t(p)>=90?"var(--color-success)":t(p)>=80?"var(--color-warning)":"var(--color-danger)"),m=N(()=>t(l).isCorrect?"‚úì":t(p)>=80?"‚óê":"‚úó");var x=Fe(),$=s(x),V=s($,!0);e($);var I=r($,2),B=s(I);e(I),e(x),R((L,G)=>{wt(x,`display: flex; align-items: center; gap: 4px; padding: 4px 8px; border-radius: 4px; background: ${t(M)??""}; font-size: 12px;`),Se(x,"title",`Run #${v+1}: ${t(p)??""}%${L??""}`),wt($,`color: ${t(f)??""}; font-weight: bold;`),u(V,t(m)),wt(I,`color: ${t(f)??""};`),u(B,`${t(p)??""}%${G??""}`)},[()=>t(l).durationMs!==void 0?", "+Z(t(l).durationMs):"",()=>t(l).durationMs!==void 0?` ¬∑ ${Z(t(l).durationMs)}`:""]),d(y,x)}),e(c),e(o),d(C,o)};h(et,C=>{!t(Y)&&t(g).runs&&t(g).runs.length>0&&C(lt)})}var bt=r(et,2);{var ht=C=>{var o=Ge(),c=r(s(o),2);yt(c,17,()=>t(g).runs,$t,(y,l,v)=>{const p=N(()=>Ot(t(l).score||0)),M=N(()=>t(p)>=90?"var(--color-success)":t(p)>=80?"var(--color-warning)":"var(--color-danger)");var f=Ve(),m=s(f),x=s(m);x.textContent=`Run #${v+1}`;var $=r(x,2);K($,{get score(){return t(l).score}});var V=r($,2);{var I=J=>{var b=Ue(),q=s(b);e(b),R(vt=>u(q,`‚è± ${vt??""}`),[()=>Z(t(l).durationMs)]),d(J,b)};h(V,J=>{t(l).durationMs!==void 0&&J(I)})}e(m);var B=r(m,2),L=r(s(B),2),G=s(L,!0);e(L),e(B),e(f),R(()=>{wt(f,`background: var(--color-bg-elevated); padding: 10px 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid ${t(M)??""};`),u(G,t(l).actualOutput||(t(l).error?`Error: ${t(l).error}`:"N/A"))}),d(y,f)}),e(o),d(C,o)};h(bt,C=>{t(Y)&&t(g).runs&&t(g).runs.length>0&&C(ht)})}e(E),R((C,o)=>{u(nt,`${C??""}${t(g).input.length>200?"...":""}`),u(it,o)},[()=>t(g).input.substring(0,200),()=>oe(t(g).expectedOutput)]),d(D,E)}),R(()=>{mt=Kt(H,1,"btn-toggle-runs",null,mt,{active:t(Y)}),u(At,t(Y)?"Hide Individual Runs":"Show Individual Runs")}),d(gt,St)};h(_t,gt=>{t(T)&&gt(A)})}d(k,j)},$$slots:{titleBadge:!0,footer:!0,default:!0}})}d(Yt,Ft),me(),jt()}be(["click","keydown"]);export{os as component};
